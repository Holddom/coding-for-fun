# 动态内存

**动态内存与智能指针**    **头文件memory**

**shared_ptr类**

shared_ptr允许多个指针指向同一个对象

类似vector 智能指针也是模板

p401 shared_ptr and unique_ptr 都支持的操作

和shared 独有的操作

**make_shared函数**

类似运算符new

make_shared<T>(args)

返回一个shared指针 指向T

类似emplace

**share_ptr的拷贝和赋值**

我们可以认为每个shared都有一个关联的计数器

通常称为引用计数	无论合适我们拷贝一个

当用一个shared初始化另一个shared

作为参数传递给函数

作为函数的返回值

它所关联的计数器就会递增

当我们给shared赋予一个新值 或shared被销毁（例如一个局部的shared离开其作用域

计数器会递减

当一个shared的计数器变为0 它就会自动释放自己所管理的对象

**shared_ptr自动销毁所管理的对象**

销毁通过析构函数

**shared_ptr还会自动释放相关联的内存**

只要还有shared对象引用 那么它指向的对象内存就不会被释放

如果忘记销毁程序不再需要的shared 会浪费内存

*如果把shared放在一个容器里 如果有一些元素不需要 需要用erase删除*

**使用了动态生存期的资源的类**

为什么要使用动态内存

1 不知道需要使用多少对象

2 不知道所需对象的准确类型

3 需要在多个对象间共享数据



一荣俱荣



